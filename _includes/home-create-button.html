{% comment %}
  홈페이지에 Create Post 버튼 추가
  인증된 사용자에게만 표시됩니다
{% endcomment %}

{% include github-auth-loader.html %}

<div class="home-create-button admin-only" style="display: none; text-align: center; margin: 2rem 0;">
  <a href="/admin?new=true" 
     class="btn btn-primary btn-lg" 
     style="text-decoration: none;">
    <i class="fas fa-plus-circle"></i> Create New Post
  </a>
</div>

<div class="home-create-button auth-required" style="text-align: center; margin: 2rem 0;">
  <button onclick="if(window.githubAuth) { window.githubAuth.login(); } else { alert('GitHub 인증이 로드되지 않았습니다.'); }" 
          class="btn btn-outline-primary btn-lg">
    <i class="fab fa-github"></i> Login with GitHub to Create Post
  </button>
</div>

<script>
  // 페이지 로드 후 인증 상태 확인
  function checkAuthAndShowButtons() {
    if (window.githubAuth && window.githubAuth.isAuthenticated()) {
      document.querySelectorAll('.home-create-button.admin-only').forEach(el => {
        el.style.display = 'block';
      });
      document.querySelectorAll('.home-create-button.auth-required').forEach(el => {
        el.style.display = 'none';
      });
    } else {
      document.querySelectorAll('.home-create-button.admin-only').forEach(el => {
        el.style.display = 'none';
      });
      document.querySelectorAll('.home-create-button.auth-required').forEach(el => {
        el.style.display = 'block';
      });
    }
  }

  // DOMContentLoaded 또는 githubAuth 로드 후 실행
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', checkAuthAndShowButtons);
  } else {
    checkAuthAndShowButtons();
  }

  // githubAuth가 나중에 로드될 경우를 대비
  if (window.githubAuth) {
    checkAuthAndShowButtons();
  } else {
    window.addEventListener('github-auth-ready', checkAuthAndShowButtons);
  }
  
  // 인증 성공 이벤트 리스너
  window.addEventListener('github-auth-success', () => {
    document.querySelectorAll('.home-create-button.admin-only').forEach(el => {
      el.style.display = 'block';
    });
    document.querySelectorAll('.home-create-button.auth-required').forEach(el => {
      el.style.display = 'none';
    });
  });
  
  // 로그아웃 이벤트 리스너
  window.addEventListener('github-auth-logout', () => {
    document.querySelectorAll('.home-create-button.admin-only').forEach(el => {
      el.style.display = 'none';
    });
    document.querySelectorAll('.home-create-button.auth-required').forEach(el => {
      el.style.display = 'block';
    });
  });
</script>
